<!DOCTYPE html>
<html>
<head>
    <title>DW Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet">
</head>

<body class="bg-light">

<div class="container py-4">

    <h1 class="mb-4 text-center">Retail DW Dashboard</h1>

    <!-- KPI Row -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="p-3 bg-white rounded shadow">
                <h4>Total Sales</h4>
                <h2 class="text-success">Rp {{ "{:,.0f}".format(total_sales) }}</h2>
            </div>
        </div>
        <div class="col-md-6">
            <div class="p-3 bg-white rounded shadow">
                <h4>Total Quantity</h4>
                <h2 class="text-primary">{{ total_qty }}</h2>
            </div>
        </div>
    </div>

    <!-- Daily sales -->
    <div class="bg-white p-4 rounded shadow mb-4">
        <h4>Daily Sales</h4>
        <canvas id="dailyChart"></canvas>
    </div>

    <!-- Payment Summary -->
    <div class="bg-white p-4 rounded shadow mb-4">
        <h4>Payment Summary</h4>
        <canvas id="paymentChart"></canvas>
    </div>

    <!-- Top products -->
    <div class="bg-white p-4 rounded shadow mb-4">
        <h4>Top 5 Products</h4>
        <canvas id="topProductChart"></canvas>
    </div>

    <!-- Sales by category -->
    <div class="bg-white p-4 rounded shadow mb-4">
        <h4>Sales by Category</h4>
        <canvas id="categoryChart"></canvas>
    </div>

    <!-- Product basket frequency -->
    <div class="bg-white p-4 rounded shadow mb-5">
        <h4>Most Frequently Bought Products</h4>
        <canvas id="basketChart"></canvas>
    </div>

</div>

<script>
    /* ---------------- Daily Sales ---------------- */
    const daily = {{ daily | tojson }};
    const dailyLabels = daily.map(x => x[0]);
    const dailyValues = daily.map(x => x[1]);

    new Chart(document.getElementById("dailyChart"), {
        type: "line",
        data: {
            labels: dailyLabels,
            datasets: [{
                label: "Daily Sales",
                data: dailyValues,
                borderColor: "#0d6efd",
                fill: false,
                tension: 0.3
            }]
        }
    });

    /* ---------------- Payment Summary ---------------- */
    const payment = {{ payment | tojson }};
    new Chart(document.getElementById("paymentChart"), {
        type: "pie",
        data: {
            labels: payment.map(x => x[0]),
            datasets: [{
                data: payment.map(x => x[1])
            }]
        }
    });

    /* ---------------- Top Products ---------------- */
    const topProducts = {{ top_products | tojson }};
    new Chart(document.getElementById("topProductChart"), {
        type: "bar",
        data: {
            labels: topProducts.map(x => x[0]),
            datasets: [{
                label: "Sales",
                data: topProducts.map(x => x[1]),
                backgroundColor: "#6c5ce7"
            }]
        }
    });

    /* ---------------- Sales by Category ---------------- */
    const cat = {{ sales_by_category | tojson }};
    new Chart(document.getElementById("categoryChart"), {
        type: "doughnut",
        data: {
            labels: cat.map(x => x[0]),
            datasets: [{
                data: cat.map(x => x[1])
            }]
        }
    });

    /* ---------------- Basket Frequency ---------------- */
    const basket = {{ basket_freq | tojson }};
    new Chart(document.getElementById("basketChart"), {
        type: "bar",
        data: {
            labels: basket.map(x => x[0]),
            datasets: [{
                label: "Frequency",
                data: basket.map(x => x[1]),
                backgroundColor: "#00b894"
            }]
        }
    });
</script>

</body>
</html>
